<!DOCTYPE html>
<html lang="en">
        <?php 
                $pageTitle = 'Lesson ' . $lessonNumber;
                $currentPage = 'my_courses'; // To keep My Courses active in sidebar
                $extraStyles = '<link rel="stylesheet" href="public/styles/lesson.css">';
                $extraScripts = '<script src="public/scripts/lesson.js" defer></script>';
                include 'partials/header.php'; 
        ?>
<body>
        <div class="app-container">
                <?php include 'partials/sidebar.php'; ?>

                <main class="main-content lesson-main">
                        <header>
                                <div class="header-text">
                                        <a href="/dashboard" class="back-link">← Back to Dashboard</a>
                                        <h1><?= htmlspecialchars($lesson['title']) ?></h1>

                                        <div class="lesson-meta" style="margin-top: 10px;">
                                                <span class="lesson-badge">Lesson <?= $lessonNumber ?></span>
                                        </div>
                                </div>

                                <div class="ram-container">
                                        <span class="ram-icon">⚡</span>
                                        <span class="ram-count"><?= $ram; ?> RAM</span>
                                </div>
                        </header>

                        <div class="lesson-wrapper">
                                <div class="lesson-container" data-total-slides="<?= count($lesson['sublessons']) ?>">
                                        <div class="progress-indicator">
                                                <?php foreach ($lesson['sublessons'] as $index => $sub): ?>
                                                        <div id="dot-<?= $index ?>" class="progress-dot <?= $index === 0 ? 'active' : '' ?>"></div>
                                                <?php endforeach; ?>
                                        </div>

                                        <?php foreach ($lesson['sublessons'] as $index => $sub): ?>
                                                <div id="slide-<?= $index ?>" class="sublesson-slide" 
                                                     data-type="<?= $sub['type'] ?>" 

                                                        <h2><?= htmlspecialchars($sub['title']) ?></h2>

                                                        <div class="slide-content-area">
                                                                <?php if ($sub['type'] === 'info'): ?>
                                                                        <p class="lesson-text"><?= nl2br(htmlspecialchars($sub['content'])) ?></p>
                                                                <?php elseif ($sub['type'] === 'embed'): ?>
                                                                        <div class="video-container">
                                                                                <iframe 
                                                                                        data-src="<?= htmlspecialchars($sub['url']) ?>" 
                                                                                        src="" 
                                                                                        allowfullscreen>
                                                                                </iframe>
                                                                        </div>
                                                                <?php elseif ($sub['type'] === 'video'): ?>
                                                                        <div class="video-container">
                                                                                <video 
                                                                                        data-src="<?= htmlspecialchars($sub['url']) ?>" 
                                                                                        controls 
                                                                                        playsinline>
                                                                                </video>
                                                                        </div>
                                                                <?php else: ?>
                                                                        <p class="question-text"><?= htmlspecialchars($sub['question']) ?></p>

                                                                        <div class="quiz-container">
                                                                                <?php if ($sub['type'] === 'multiple_choice'): ?>
                                                                                        <?php foreach ($sub['options'] as $opt): ?>
                                                                                                <label class="option-label">
                                                                                                        <input type="radio" name="q-<?= $index ?>" value="<?= htmlspecialchars($opt) ?>">
                                                                                                        <span class="label-text"><?= htmlspecialchars($opt) ?></span>
                                                                                                </label>
                                                                                        <?php endforeach; ?>

                                                                                <?php elseif ($sub['type'] === 'true_false'): ?>
                                                                                        <label class="option-label">
                                                                                                <input type="radio" name="q-<?= $index ?>" value="true"> 
                                                                                                <span class="label-text">True</span>
                                                                                        </label>
                                                                                        <label class="option-label">
                                                                                                <input type="radio" name="q-<?= $index ?>" value="false"> 
                                                                                                <span class="label-text">False</span>
                                                                                        </label>

                                                                                <?php elseif ($sub['type'] === 'input'): ?>
                                                                                        <input type="text" id="input-<?= $index ?>" class="quiz-input" placeholder="Type your answer...">
                                                                                <?php endif; ?>
                                                                        </div>

                                                                        <div id="feedback-<?= $index ?>" class="feedback-area"></div>
                                                                <?php endif; ?>
                                                        </div>
                                                </div>
                                        <?php endforeach; ?>

                                        <div class="footer-actions">
                                                <div class="sublesson-counter">
                                                        <span id="current-step">1</span>/<?= count($lesson['sublessons']) ?>
                                                </div>

                                                <button id="btn-action" class="btn-large">Continue</button>

                                                <form id="complete-form" action="/complete-lesson" method="POST" style="display:none;">
                                                        <input type="hidden" name="csrf_token" value="<?= $_SESSION['csrf_token'] ?>">
                                                        <input type="hidden" name="course_id" value="<?= $_GET['id'] ?>">
                                                </form>
                                        </div>
                                </div>
                        </div>
                </main>
                <div id="toast-container"></div>
        </div>
</body>
</html>
